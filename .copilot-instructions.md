# ü§ñ Zasady pracy AI Copilot dla projektu ZZP Werkplaats

## üìã FUNDAMENTALNE ZASADY

### 1. PRACA NA BAZIE DANYCH SUPABASE
- **ZAWSZE** pracujesz na bazie Supabase tego projektu
- Projekt: `dtnotuyagygexmkyqtgb.supabase.co`
- **NIGDY** nie zak≈Çadaj struktury danych - zawsze sprawdzaj faktyczny stan

### 2. WORKFLOW PRZED KA≈ªDYM SQL

#### Krok 1: Sprawd≈∫ aktualnƒÖ strukturƒô bazy
```bash
npm run db:schema
```
- Je≈õli polecenie nie istnieje, utw√≥rz skrypt `scripts/schema-check.mjs`
- Przeczytaj wygenerowany plik `.tmp/schema.json`

#### Krok 2: Analiza istniejƒÖcych danych
- **ZAWSZE** uruchom zapytania `SELECT` przed `UPDATE/DELETE/ALTER`
- Sprawd≈∫ constraints (NOT NULL, FOREIGN KEY, UNIQUE)
- Sprawd≈∫ faktyczne dane w tabelach
- Zidentyfikuj potencjalne konflikty

#### Krok 3: Przygotuj migracjƒô
- Ka≈ºda zmiana struktury = nowy plik w `database-migrations/`
- Format nazwy: `YYYYMMDD_HHMM_opis_zmiany.sql`
- U≈ºyj `npm run db:migrate:plan` je≈õli dostƒôpne

#### Krok 4: Testuj lokalnie przed produkcjƒÖ
- Uruchom migracjƒô w trybie read-only
- Zweryfikuj wyniki
- Dopiero wtedy zastosuj zmiany

### 3. GENEROWANIE SKRYPT√ìW SQL

#### ‚úÖ ZAWSZE:
- Sprawd≈∫ `information_schema` przed zmianami
- Dodaj komentarze wyja≈õniajƒÖce cel ka≈ºdej sekcji
- U≈ºyj transakcji dla wielu operacji
- Dodaj rollback plan
- Sprawd≈∫ wynik po wykonaniu (SELECT na ko≈Ñcu)

#### ‚ùå NIGDY:
- Nie usuwaj danych bez analizy
- Nie zmieniaj constraints bez sprawdzenia danych
- Nie zak≈Çadaj ≈ºe kolumna ma warto≈õci kt√≥re my≈õlisz
- Nie modyfikuj RLS policies bez pytania
- Nie u≈ºywaj `DROP TABLE` bez explicit confirmation

### 4. POSTGRES 15 + SUPABASE RLS

#### Kompatybilno≈õƒá:
- SQL zgodny z PostgreSQL 15
- U≈ºywaj `DO $$ BEGIN ... END $$;` dla blok√≥w procedurralnych
- Sprawdzaj istnienie obiekt√≥w przed CREATE/DROP
- U≈ºywaj `IF EXISTS` / `IF NOT EXISTS`

#### Row Level Security (RLS):
- **NIE RUSZAJ** RLS policies bez wyra≈∫nej pro≈õby
- Je≈õli trzeba - najpierw poka≈º istniejƒÖce policies
- Wyja≈õnij wp≈Çyw zmian na bezpiecze≈Ñstwo
- Zachowaj minimalne uprawnienia

### 5. MIGRACJE BAZY DANYCH

#### Struktura migracji:
```sql
-- ============================================
-- MIGRATION: [Opis co robi]
-- Date: YYYY-MM-DD
-- Author: AI Copilot
-- ============================================

-- ROLLBACK PLAN:
-- [Opisz jak cofnƒÖƒá zmiany]

-- STEP 1: Analyze current state
SELECT ... FROM information_schema ...;

-- STEP 2: Make changes
BEGIN;
  -- Zmiany tutaj
  -- Z mo≈ºliwo≈õciƒÖ ROLLBACK
COMMIT;

-- STEP 3: Verify results
SELECT ... -- Sprawdzenie czy siƒô uda≈Ço
```

### 6. WORKFLOW "READ-ONLY FIRST"

Gdy nie masz 100% pewno≈õci:

1. **Najpierw:** Wygeneruj zapytanie SELECT do inspekcji
   ```sql
   SELECT * FROM information_schema.columns WHERE table_name = 'xyz';
   SELECT * FROM table WHERE condition LIMIT 10;
   ```

2. **Potem:** Przeanalizuj wyniki z u≈ºytkownikiem

3. **Na ko≈Ñcu:** Wygeneruj ALTER/UPDATE/DELETE

### 7. NAZEWNICTWO I STRUKTURA KODU

#### ‚úÖ DOBRE PRAKTYKI:
- Pe≈Çne, opisowe nazwy zmiennych/funkcji
- Nie u≈ºywaj skr√≥t√≥w (np. `usr` ‚Üí `user`, `emp` ‚Üí `employer`)
- Komentarze po polsku dla kontekstu biznesowego
- Komentarze po angielsku dla kodu technicznego

#### ‚ùå Z≈ÅE PRAKTYKI:
- Placeholdery typu `// TODO: implement`
- Proste strony demo zamiast prawdziwej funkcjonalno≈õci
- Skr√≥ty my≈õlowe typu `tmp`, `val`, `obj`
- Usuwanie istniejƒÖcych plik√≥w bez pytania

### 8. PROJEKT ZZP WERKPLAATS - KONTEKST

#### G≈Ç√≥wny cel:
Utrzymaƒá aplikacjƒô **stabilnƒÖ i profesjonalnƒÖ**

#### Stack technologiczny:
- **Frontend:** React 18 + TypeScript + Vite
- **Backend:** Supabase (PostgreSQL 15)
- **Real-time:** Supabase Realtime subscriptions
- **Auth:** Supabase Auth
- **Storage:** Supabase Storage

#### Kluczowe tabele:
- `profiles` - dane u≈ºytkownik√≥w
- `workers` - profil pracownika
- `employers` - profil pracodawcy
- `jobs` - oferty pracy
- `job_applications` - aplikacje do ofert
- `messages` - wiadomo≈õci miƒôdzy u≈ºytkownikami
- `notifications` - powiadomienia

### 9. PROCES DEBUGOWANIA

#### Gdy u≈ºytkownik zg≈Çasza b≈ÇƒÖd:

1. **Zbierz informacje:**
   - Dok≈Çadny komunikat b≈Çƒôdu
   - Plik i linia gdzie wystƒÖpi≈Ç
   - Kroki do reprodukcji

2. **Sprawd≈∫ bazƒô danych:**
   ```bash
   npm run db:schema
   ```
   - Zweryfikuj strukturƒô tabel
   - Sprawd≈∫ constraints
   - Przeanalizuj RLS policies

3. **Przeanalizuj kod:**
   - Znajd≈∫ miejsce wywo≈Çania
   - Sprawd≈∫ typy danych
   - Zweryfikuj query Supabase

4. **Zaproponuj fix:**
   - Najpierw read-only analiza
   - Potem konkretna zmiana
   - Na ko≈Ñcu weryfikacja

### 10. KOMUNIKACJA Z U≈ªYTKOWNIKIEM

#### ‚úÖ ZAWSZE:
- Wyja≈õnij CO robisz i DLACZEGO
- Poka≈º SQL przed wykonaniem
- Popro≈õ o potwierdzenie dla destruktywnych operacji
- Przeanalizuj wyniki zapyta≈Ñ razem z u≈ºytkownikiem

#### ‚ùå NIGDY:
- Nie wykonuj SQL bez pokazania go u≈ºytkownikowi
- Nie zak≈Çadaj ≈ºe wiesz co jest w bazie
- Nie usuwaj danych "na ≈õlepo"
- Nie ignoruj b≈Çƒôd√≥w typu constraint violation

---

## üéØ WORKFLOW SUMMARY

```
1. User Request
   ‚Üì
2. npm run db:schema (sprawd≈∫ strukturƒô)
   ‚Üì
3. Read .tmp/schema.json
   ‚Üì
4. SELECT queries (analiza danych)
   ‚Üì
5. Poka≈º wyniki u≈ºytkownikowi
   ‚Üì
6. Zaproponuj rozwiƒÖzanie
   ‚Üì
7. Przygotuj migracjƒô SQL
   ‚Üì
8. User approval
   ‚Üì
9. Execute SQL
   ‚Üì
10. Verify results (SELECT check)
```

---

## üìù PRZYK≈ÅAD POPRAWNEGO WORKFLOW

```markdown
User: "Napraw foreign key miƒôdzy jobs a employers"

‚ùå Z≈ÅE:
ALTER TABLE jobs ADD CONSTRAINT fk_jobs_employer 
FOREIGN KEY (employer_id) REFERENCES employers(id);

‚úÖ DOBRE:
1. Najpierw: npm run db:schema
2. Sprawd≈∫: SELECT * FROM information_schema.columns WHERE table_name = 'jobs';
3. Analiza: SELECT employer_id FROM jobs WHERE employer_id NOT IN (SELECT id FROM employers);
4. Raport: "Znalaz≈Çem 5 jobs z nieistniejƒÖcymi employer_id"
5. Plan: "Musimy najpierw naprawiƒá dane, potem dodaƒá FK"
6. SQL z analizƒÖ + cleanup + FK constraint
7. User approval
8. Execute
9. Verify: SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 'jobs';
```

---

**Przestrzeganie tych zasad = stabilna aplikacja + zadowolony u≈ºytkownik** ‚úÖ
